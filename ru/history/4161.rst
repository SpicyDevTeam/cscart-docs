******
4.16.1
******

==================================
Новая функциональность и улучшения
==================================

[+] Дизайн: Добавлено массовое редактирование товаров на планшетах с маленьким экраном.

[+] Мобильное приложение: Добавлена поддержка Stripe и Stripe connect для оплаты картой.

[+] Мобильное приложение: Добавлены требования Google по UGC (User Generated Content) — согласие с условиями и возможность пожаловаться.

[+] Модули: Тинькофф [Beta]: Добавлен новый модуль для приема платежей с помощью Тинькофф.

[+] Модули: Тинькофф [Beta]: Добавлена возможность отправить чек при оплате заказа (54-ФЗ).

[+] Модули: Тинькофф Сплитование [Beta]: Добавлен модуль способа оплаты через банк Тинькофф с поддержкой разделения платежей.

[+] Модули: Добавлена новая страница "Маркет модулей" c поиском на marketplace.cs-cart.com.

[+] Способы оплаты: Платежи через Stripe: Добавлена поддержка Stripe Checkout с возможностью оплаты через официальную страницу Stripe.

[+] Способы оплаты: Платежи через Stripe: Появилась возможность использовать для оплаты Apple Pay и Google Play через Stripe Checkout.

[+] Способы оплаты: Платежи через Stripe: Добавлено множество локальных способов оплаты таких, как Sofort, Klarna, Afterparty и прочие через Stripe Checkout.

[+] Центр уведомлений: Добавлена кнопка "Пометить все как прочитанное".

[+] Multi-Vendor: Дизайн: Панель продавца: Пункт "Информация о продавце" был добавлен для меню пользователя.

[+] Multi-Vendor: Модули: Платежи через Stripe Connect: В описание вывода средств добавлена информация о комиссии Stripe.

[+] Multi-Vendor: Модули: Платежи через Stripe Connect: Добавлена поддержка Stripe Checkout с возможностью оплаты через официальную страницу Stripe.

[+] Multi-Vendor: Модули: Платежи через Stripe Connect: Появилась возможность использовать для оплаты Apple Pay и Google Play через Stripe Checkout.

[+] Multi-Vendor: Модули: Платежи через Stripe Connect: Добавлено множество локальных способов оплаты таких, как Sofort, Klarna, Afterparty и прочие через Stripe Checkout.

=========================================
Изменения в существующей функциональности
=========================================

[*] База данных: Улучшена поддержка InnoDB таблиц.

[*] Дизайн: Блоки: HTML блок с поддержкой Smarty заменен на новый более безопасный блок с таким же названием.

[*] Модули: CommerceML: Производительность: Значительно ускорен импорт файла import.xml с большим количеством вариантов характеристик у товаров.

[*] Модули: CommerceML: У нового модуля CommerceML убрана пометка "Бета". Старый модуль CommerceML помечен как устаревший, и теперь его нельзя установить в новых установках "CS-Cart для маркетплейсов".

[*] Секция помощи: Внешний вид секции помощи был обновлен.

[*] Центр уведомлений: Мобильный режим: Центр уведомлений был адаптирован для отображения на мобильных устройствах.

[*] Ядро: Javascript: Безопасность: Библиотека jQuery UI была обновлена до версии 1.13.2.

==================
Исправления ошибок
==================

[!] База данных: На MariaDB добавление нескольких вариаций товаров в корзину могло привести к долгому открытию страницы оформления заказа. Исправлено.

[!] Валюты: Альтернативная валюта не отображалась в Email-уведомлении после оформления заказа. Исправлено.

[!] Валюты: Курсы валют онлайн: Иногда не отображались курсы валют. Исправлено; Добавлена возможность использовать свой API-ключ для получения курса валют.

[!] Выбор периода: При определенных условиях выбор периода "Текущая неделя", "Вчера", "Последние 24 часа" и "Предыдущая неделя" работали некорректно. Исправлено.

[!] Дебагер: Кнопка закрытия режима отладки отображалась некорректно. Исправлено.

[!] Дизайн: Frontend: W3C: W3C CSS валидатор обнаруживал ошибки. Исправлено.

[!] Дизайн: В некоторых случаях один заголовок мог отображаться у разных блоков. Исправлено.

[!] Дизайн: Всплывающие окна: Если закрыть всплывающее окно во время выполнения AJAX-запроса, то могла возникнуть ошибка. Исправлено.

[!] Дизайн: Макеты: Блоки: Некоторые блоки имели текстовое поле, которое нельзя было настроить для отдельных языков. Исправлено.

[!] Дизайн: Меню: Текстовые ссылки: Активный пункт в подменю отображался некорректно. Исправлено.

[!] Дизайн: Панель администратора: В меню шапки панели администратора некорректно отображались подменю. Исправлено.

[!] Дизайн: Панель администратора: Загрузчик файлов отображался некорректно. Исправлено.

[!] Дизайн: Промо-текст: На странице товара промо-текст мог смещаться. Исправлено.

[!] Дизайн: Темы: При копировании темы не сохранялись логотипы. Исправлено.

[!] Дизайн: Шрифты: При сохранении шрифтов могла возникнуть ошибка. Исправлено.

[!] Документы: Email уведомления: Предпросмотр шаблонов для уведомлений статусов заказов вызывал ошибку. Исправлено.

[!] Заказы: Отчеты о продажах: При включенном формате отображения альтернативной валюты "Показывать цены в валюте по умолчанию и в выбранной валюте" отчеты о продажах отображались некорректно. Исправлено.

[!] Заказы: При оформлении заказа в базу данных сохранялись все доступные пункты выдачи заказа. Исправлено.

[!] Макеты: При перетаскивании блока страница не скроллилась. Исправлено.

[!] Мобильное приложение: Картинка для описания не добавлялась в архив настроек. Исправлено

[!] Мобильное приложение: Отображалась ошибка при попытке открыть приложение без интернета. Исправлено.

[!] Мобильное приложение: Модули: ЮKassa: Не работало создание заказа при использовании способа оплаты с процессором ЮKassa. Исправлено.

[!] Модули: АТОЛ Онлайн: При редактировании заказа без изменения статуса пробивался чек. Исправлено.

[!] Модули: Вариации товаров: Блоки: Блок "Список вариаций" не учитывал настройку "Показывать только товары в наличии". Исправлено.

[!] Модули: Вариации товаров: Вариации были недоступными, если товар был доступен для предзаказа. Исправлено.

[!] Модули: Вариации товаров: Вариации, которых нет в наличии, могли быть скрыты на витрине при включенной настройке "Показывать товары, которых нет в наличии". Исправлено.

[!] Модули: Вариации товаров: Расширенный импорт товаров: Импорт товара с вариациями без указания вариации по умолчанию, мог указывать вариацией по умолчанию не первую в списке. Исправлено.

[!] Модули: Возврат товаров: При обновлении товаров через импорт использовались настройки возврата товара по умолчанию. Исправлено.

[!] Модули: Возникал PHP Notice при удалении уже удаленного модуля. Исправлено.

[!] Модули: Города: Служба доставки — СДЭК: Удален город "5663234234".

[!] Модули: Карты и геолокация: Требуемые товары: Появлялось уведомление о добавлении обязательных товаров в корзину при просмотре товара. Исправлено.

[!] Модули: Калькулятор стоимости доставки eDost.ru: У некоторых населенных пунктов отсутствовал код доставки. Исправлено.

[!] Модули: Комплекты товаров: Вариации товаров: Для вариаций на основе одного товара нельзя было повторно выбрать характеристику в комплекте товаров. Исправлено.

[!] Модули: Комплекты товаров: Детальная страница заказа могла открываться с ошибкой. Исправлено.

[!] Модули: Комплекты товаров: Настройка "Показывать на странице товара" работала некорректно. Исправлено.

[!] Модули: Комплекты товаров: Один из товаров комплекта отображался со скидкой, несмотря на то, что цена товара не менялась. Исправлено.

[!] Модули: Лендинги из Тильды: CSS стили темы могли влиять на внешний вид страницы из Тильды. Исправлено.

[!] Модули: Лендинги из Тильды: Автоматическая синхронизация не работала. Исправлено.

[!] Модули: Лендинги из Тильды: Дополнительные шрифты не загружались. Исправлено.

[!] Модули: Магазины и пункты самовывоза: Бонус "Бесплатная доставка" не применялся к пунктам самовывоза. Исправлено.

[!] Модули: Магазины и пункты самовывоза: Заказы: Простые HTML-теги не допускались в упаковочном реестре заказа. Исправлено.

[!] Модули: Отзывы и комментарии: Была некорректная ссылка на настройки модуля. Исправлено.

[!] Модули: Отложенные товары: Сбрасывался список отложенных товаров при авторизации на витрине через панель администратора. Исправлено.

[!] Модули: Подарочные сертификаты: Сертификаты не удалялись из корзины. Исправлено.

[!] Модули: Платежи через Stripe: При использовании валют с нулевым числом знаков после запятой в Stripe отправлялась некорректная сумма заказа. Исправлено.

[!] Модули: Прайс-лист: Вариации товара, созданные как один товар, не выгружались в прайс-лист. Исправлено.

[!] Модули: ПЭК: Не выполнялся расчёт доставки для города Иваново (Ивановская область). Исправлено.

[!] Модули: Расширенный импорт товаров: Импорт/Экспорт: При импорте описания товара с переносом строк переносы не импортировались. Исправлено.

[!] Модули: Расширенный импорт товаров: Импорт товара без сопоставления названия и описания мог сломать редактирование этого товара. Исправлено.

[!] Модули: Соответствие GDPR (Общему регламенту по защите данных в ЕС): При включении модуля некорректно обновлялась конфигурация. Исправлено.

[!] Модули: Соответствие GDPR (Общему регламенту по защите данных в ЕС): В соглашении отсутствовали куки для PayPal Commerce Platform и PayPal Checkout. Исправлено.

[!] Модули: Соответствие GDPR (Общему регламенту по защите данных в ЕС): В некоторых случаях не отображалось значение языковых переменных gdpr.uk_cookies_law and gdpr.klaro_ok. Исправлено.

[!] Модули: Соответствие GDPR (Общему регламенту по защите данных в ЕС): Текст языковой переменной gdpr.uk_cookies_law отображался с запозданием. Исправлено.

[!] Модули: Цена за единицу: При включенной настройке "Прятать цену и кнопку добавления товара в корзину", отображалась цена за единицу. Исправлено.

[!] Модули: Экспорт в Яндекс.Маркет: Дата генерации прайс листа фиксировалась в некорректном формате. Исправлено.

[!] Модули: CommerceML (1С, МойСклад, Бизнес.Ру) [Beta]: Информация о доставке не импортировалась из "значений реквизитов". Исправлено.

[!] Модули: CommerceML (1С, МойСклад, Бизнес.Ру) [Beta]: При синхронизации обнулялась цена товаров. Исправлено.

[!] Модули: CommerceML: Отсутствовала языковая переменная для статуса импорта N. Исправлено.

[!] Модули: Google Analytics: Соответствие GDPR (Общему регламенту по защите данных в ЕС): Не отслеживались продажи при включённом модуле GDPR. Исправлено.

[!] Модули: PayPal Checkout: Возникала ошибка на странице редактирования заказа. Исправлено.

[!] Модули: PayPal Checkout: Могла возникнуть ошибка при оформлении заказа с целочисленной валютой. Исправлено.

[!] Модули: SEO:  PHP Warning мог возникнуть во время установки. Исправлено.

[!] Модули: SEO: SEO-имя могло формироваться с запрещённым символом точки. Исправлено

[!] Модули: SEO: Карты и геолокация: Иногда мог появляться PHP Notice. Исправлено.

[!] Модули: SEO: При выключенном или недоступном текущем языке не производился редирект на витрине. Исправлено.

[!] Модули: SEO: Вариации товаров: Промо-акции и скидки: В некоторы случаях, вариации отображались в d+json без учета скидок. Исправлено.

[!] Налоги: Заказы: Стоимость способа доставки отображалась без налога в панели администратора, если включена настройка "Отображать цены с налогами на страницах корзины/оформления заказа" и если метод расчета налогов основан на цене за единицу. Исправлено.

[!] Настройки: Внешний вид: Часовой пояс: Неправильно определялось время для часового пояса "(GMT+03:00) Хельсинки, Киев, Рига, София, Таллин, Вильнюс". Исправлено.

[!] Незавершенные покупки: Страна и область доставки могли не отображаться. Исправлено.

[!] Опции товара: При настройке "Если отсутствуют варианты: Скрыть опцию полностью" и отсутствии вариантов, комментарий опции все равно отображался. Исправлено.

[!] Отгрузки: Вкладка отслеживания доставки не отображалась на витрине при наличии одной отгрузки. Исправлено.

[!] Оформление заказа: Поля профиля: При редактировании профиля при оформлении заказа удалялись значения пользовательских полей профиля. Исправлено.

[!] Оформление заказа: В некоторых случаях при изменении индекса способы доставки не обновлялись. Исправлено.

[!] Платежи: Выводилось неверное сообщение об ошибке при заполнении данных кредитной карты в шаблоне сс.tpl. Исправлено.

[!] Поля профиля: Вместо обязательного значения можно было использовать пробел. Исправлено.

[!] Поля профиля: Оформление заказа: На форме создания/изменения данных профиля отображались все поля, вне зависимости от настроек полей профиля. Исправлено.

[!] Поля профиля: Email: Отсутствовало поле Email при создании аккаунта после оформления заказа. Исправлено.

[!] Профили: Отличался параметр столбца города доставки в таблице профилей пользователей. Исправлено.

[!] Промо-акции и скидки: Промо-акции для корзины применялись к пустой корзине. Исправлено.

[!] Редактирование заказа: Символ валюты иногда некорректно отображался в поле ввода. Исправлено.

[!] Способы оплаты: Sofort Banking: Не очищалась корзина после успешного оформления заказа со способом оплаты, использующем процессор Sofort. Исправлено.

[!] Товары: Быстрый просмотр: Кнопки "Отложить" и "Добавить в список сравнения" отображались некорректно для Responsive:Black стиля. Исправлено.

[!] Товары: Наличие товаров отображалось на витринах независимо от индивидуальных настроек отслеживания количества товаров. Исправлено.

[!] Уведомления: В уведомлении об уменьшении количества товара в корзине до максимально доступного не указывалось количество. Исправлено.

[!] Электронная почта: Письма могли отправляться в неправильном формате при использовании PHP 8.0. Исправлено.

[!] Ядро: Изображения формата WebP при загрузке теряли прозрачность. Исправлено.

[!] Ядро: Некоторые заголовки, относящиеся к IP-адресу, некорректно обрабатывались, что приводило к неправильному определению IP-адреса пользователя. Исправлено.

[!] Ядро: Сессия: После того, как сессия истекала и покупатель авторизовался заново, данные из сессии могли потеряться. Исправлено.

[!] Multi-Vendor: Заказы: Управление заказами: Email уведомления: Не отправлялись уведомления при создании заказа с товарами нескольких продавцов в панели администратора. Исправлено.

[!] Multi-Vendor: Модули: Конфигуратор панели продавцов: SEO: Вкладка SEO была недоступна продавцам. Исправлено.

[!] Multi-Vendor: Модули: Конфигуратор панели продавцов: Некорректно выделялся активный элемент меню. Исправлено.

[!] Multi-Vendor: Модули: Магазины и пункты самовывоза: Продавец не мог сохранить изменения на списке магазинов и ПВЗ. Исправлено.

[!] Multi-Vendor: Модули: Местоположение продавцов: Вместо всех продавцов отображались только те продавцы, которые отображались на странице. Исправлено.

[!] Milti-Vendor: Модули: Местоположение продавцов: Товары не фильтровались по почтовому индексу местоположения продавцов. Исправлено.

[!] Multi-Vendor: Модули: Платежи через PayPal: При оплате через PayPal мог не сработвать подарочный сертификат. Исправлено.

[!] Multi-Vendor: Модули: PayPal Commerce Platform: Повторная оплата заказа не работала. Исправлено.

[!] Multi-Vendor: Модули: PayPal Commerce Platform: Способы оплаты: Когда в настройках способа оплаты не стояла галочка "Отложить перевод средств", оплата продавцам всё равно оставалась отложенной. Исправлено.

[!] Multi-Vendor: Модули: Соответствие GDPR: Местоположение продавцов: Не работало определение местоположения после принятия кук. Исправлено.

[!] Multi-Vendor: Панель продавца: Некоторые страницы могли иметь неправильную ширину. Исправлено.

[!] Multi-Vendor: Тарифные планы для продавцов: Экспорт/импорт: При выполнении импорта продавцом могли пропускаться товары без категории. Исправлено

[!] Multi-Vendor: Модули: Требуемые товары: Товару можно было добавить требуемые товары другого продавца. Исправлено.

[!] Multi-Vendor Plus: Модули: Карта сайта для Yandex и Google: Общие товары для продавцов: Для товарных предложений формировались некорректные ссылки в карте сайта. Исправлено.

[!] Multi-Vendor Plus: Модули: Общие товары для продавцов: Карта сайта для Yandex и Google: Общий товар мог оказаться в карте сайта без доступных предложений продавцов. Исправлено.

[!] Multi-Vendor Plus: Модули: Оплата напрямую продавцам: Заказы: При создании заказа из панели администратора с первого раза товар не добавлялся. Исправлено.

[!] Multi-Vendor Plus: Общие товары для продавцов: Фильтры: В фильтре по продавцам могли отображаться отключённые продавцы. Исправлено.

[!] Multi-Vendor Ultimate: Модули: Склады: Общие товары для продавцов: При использовании склада количество общего товара не синхронизировалось с количеством его предложения. Исправлено.

[!] Multi-Vendor Ultimate: Модули: Склады: Общие товары для продавцов: С включённой настройкой "Быстрая покупка одного из предложений: в корзину не добавлялось нужное количество предложений продавцов. Исправлено.

[!] Multi-Vendor Ultimate: Категории: На детальной странице категории отсутствовал переключатель витрины. Исправлено.

[!] Multi-Vendor Ultimate: API: Продавцы: В ответе на GET запрос к сущности продавцов/витрин с указанием ID могло отсутствовать большое количество базовых полей. Исправлено.

[!] REST API: Заказы: Создание заказа не учитывало оптовую скидку. Исправлено.

[!] UI/UX: Кнопки действий на странице поиска отображались некорректно. Исправлено.

[!] UI/UX: Фильтры товаров: Если название фильтра было слишком длинным, то кнопка сворачивания блока отображалась некорректно. Исправлено.

[!] Ultimate: Дизайн: Значок шестеренки в списке витрин был серого цвета. Исправлено.

[!] Ultimate: Модули: Подарочные сертификаты: Склады: Возникала ошибка на странице заказа в панели администратора, если заказ состоял из подарочного сертификата. Исправлено.

[!] Ultimate: Модули: При ручной перезагрузке настроек и языковых переменных модуля сбрасывались настройки этого модуля для витрин. Исправлено.

[!] Ultimate: Модули: Экспорт в Яндекс.Маркет: При включенном модуле не сохранялись категории в режиме "Все витрины". Исправлено.

[!] Ultimate: После обновления в таблице "user_session_products" использовался некорректный первичный ключ. Исправлено.

[!] Ultimate: Экспорт/Импорт: Заказы: Отсутствовала возможность экспортировать заказы на сервер с одной из витрин. Исправлено.