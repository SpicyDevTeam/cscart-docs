******
ЮKassa
******

==============
Принцип работы
==============

#. На странице оформления заказа у вас в магазине покупатель выбирает способ оплаты "ЮKassa" (или как вы его назовёте).

#. При нажатии кнопки "Оформить заказ" он попадает на страницу ЮKassa, и уже там выбирает `подходящий способ оплаты <https://yookassa.ru/docs/support/payments/accept-methods>`_. 

   .. fancybox:: /user_guide/addons/yandex_checkout/img/payment_yandex.png
       :alt: Способы оплаты Яндекса и поля для ввода данных банковской карты.

   .. note::

       Такой принцип работы описан на сайте ЮKassa как `"Сценарий 1: Выбор способа оплаты на странице Кассы" <https://yookassa.ru/pay_by_yookassa/#1>`_. Его преимущество в том, что `когда ЮKassa добавит новые способы оплаты, то и вы сможете их быстро добавить <https://yookassa.ru/docs/support/payments/accept-methods#accept-methods__adding-new>`_.

=========
Настройка
=========

.. important::

    Для работы с ЮKassa `на вашем сервере должен быть установлен SSL-сертификат <https://yookassa.ru/docs/payment-solution/supplementary/security>`_. Можно использовать самоподписанный сертификат.

#. Установите модуль :doc:`/user_guide/addons/yandex_checkout/index`.

#. `Подключите ваш интернет-магазин к ЮKassa <https://yookassa.ru/joinups/?source=cscart>`_.

#. :doc:`Создайте новый cпособ оплаты <adding_payment>` с процессором *ЮKassa*.

#. Пройдите на вкладку **Настройки** нового способа оплаты и выполните настройку:

   * **URL для уведомлений** — скопируйте его отсюда в настройки магазина в личном кабинете ЮKassa. Так ЮKassa будет знать, куда сообщать о транзакциях.

   * **shopId** и **секретный ключ** — возьмите их из личного кабинета ЮKassa и скопируйте сюда. Так ЮKassa поймёт, кому полагаются деньги, заплаченные клиентом.

   * **Отправлять данные для чеков в ЮKassa (54-ФЗ)** — включите эту настройку, если за взаимодействие с онлайн-кассой у вас отвечает ЮKassa.

     .. important::

         У нас есть отдельная инструкция, :doc:`как передавать данные для чека из CS-Cart в ЮKassa, чтобы соответствовать 54-ФЗ <yandex_54fz>`.
         
   * **Выберите способ оплаты** — выберите *Все доступные способы*, если хотите, чтобы покупатель мог выбрать удобный ему способ оплаты на странице ЮKassa. 
   
     .. note::
     
         Если вы выберете какой-то конкрентный способ оплаты, например *Банковская карта*, то другие способы не будут отображены на странице ЮKassa.

   * **Статус заказа для формирования итогового чека** — статус заказа, когда покупатель получил то, за что заплатил. Когда заказ получает этот статус, ЮKassa сформирует чек зачёта предоплаты.
   
   * **Включить холдирование** — поставьте галочку, если хотите включить отложенную оплату. Подробнее о холдировании вы можете прочитать `в этой статье <https://yookassa.ru/holdirovanie/>`_.
   
   * **Статус заказов с холдированием (до передачи средств)** — выберите статус, который получит заказ после заморозки средств покупателя до полной оплаты заказа.
   
   * **Валюта** — выберите валюту, которая используется в учётной записи ЮKassa. Она должна совпадать с базовой валютой в вашем магазине.
   
   * **Статус частично возвращённого заказа** — выберите статус, который получит заказ после регистрации запроса на возврат.
   
   * **Статус полностью возвращённого заказа** — выберите статус, который получит заказ после того, как возврат будет полностью совершён.

#. Нажмите кнопку **Создать**.

   .. fancybox:: img/ya_checkout_settings.png
       :alt: Вкладка Настройки способа оплаты Яндекс.Касса

Связанные статьи
================

.. toctree::
    :maxdepth: 2
    :titlesonly:
    :glob:

    yandex_54fz

.. toctree::
    :maxdepth: 2
    :hidden:

    mws
