===============================
Тинькофф для интернет-магазинов
===============================

.. note:: 

    В "CS-Cart для интернет-магазинов" 4.16.1 появилась возможность принимать оплату через Тинькофф. 

В данной статье рассмотрим процесс настройки способа оплаты с возможностью принимать оплату через СБП и QR-коды с помощью подключения к Тинькофф. :doc:`Подробнее об остальных возможностях </user_guide/addons/tinkoff/index>`, которые появились благодаря интеграции с Тинькофф.

Перед началом настройки способа оплаты в панели администратора, владелец интернет-магазина должен `связаться с менеджером банка Тинькофф <https://www.tinkoff.ru/business/payments/>`_ для заключения договора и получения доступа в личный кабинет. Обычно после подачи заявки и подписания договора банку требуется пара дней для создания магазина в вашем личном кабинете. Когда личный кабинет и магазин созданы, можно приступать к настройке на стороне CS-Cart. 

1. Установите модуль “Тинькофф [Beta]” на странице **Модули → Скачанные модули**.

2. Перейдите на страницу **Администрирование → Способы оплаты**.

3. Добавьте новый способ оплаты, нажав на **+** в верхней правой части страницы.

4. Заполнить поля, перемещаясь по вкладкам.

Вкладка *Общее*
-----------------

Главное выбрать в качестве **Процессора** Tinkoff из списка *Российских способов оплаты*. Остальные поля заполняются :doc:`в соответствии с их значениями </user_guide/payment_methods/configure_payment>`. 

Вкладка *Настроить*
---------------------

1) Из раздела **Информация** скопируйте самую первую ссылку “URL для уведомлений” — ссылка на страницу, которая принимает сообщения об успешной оплате, ошибках и другую нотификацию. 

.. fancybox:: img/URLs_store_builder.png
     :alt: Раздел "Информация" в настройках способа оплаты с процессором Tinkoff.

2) Далее перейдите в личный кабинет “Тинькофф бизнес” и откройте вкладку `Интернет-эквайринг → Магазины <https://business.tinkoff.ru/oplata/mpa/merchant/eacq>`_. Кликните по названию вашего магазина. Справа вы увидите несколько вкладок с настройками и полезными данными: *О магазине*, *Способы оплаты*, *Тариф*, *Терминалы*, *Онлайн-касса*. 

   Так на вкладке *Способы оплаты* указаны доступные способы оплаты. На момент выхода CS-Cart 4.16.1 с интеграцией с Тинькофф действуют банковские карты, СБП и оплата по QR-кодам. 

   Если вы хотите, чтобы у покупателей была дополнительная возможность оплачивать товары через СБП при использовании способа оплаты Тинькофф, тогда:

   * `Откройте счёт в Тинькофф <https://business.tinkoff.ru/sme>`_ и сделайте его счётом для выплат.

   * Находясь на вкладке *Способы оплаты*, активируйте "Систему быстрых платежей".

   .. fancybox:: img/SBP_active.png
       :alt: Активированный способ оплаты "СБП".

3) Откройте вкладку *Терминалы* и настройте рабочий терминал. В разделе **Уведомления** вставьте скопированную ссылку для уведомлений. 

4) Далее скопируйте из панели администратора URL для удавшихся платежей и вставьте в поле для ссылки на страницу успеха. То же самое и с третьей ссылкой: URL для неудавшихся платежей вставьте в поле для страницы ошибки. 

5) Остальные настройки на странице настроек терминала оставьте по умолчанию. Сохраните изменения.

6) Оставаясь на странице с настройками терминала последовательно скопируйте номер терминала и пароль  из окошка справа и вставьте в поля **Терминал** и **Пароль** в настройках способа оплаты панели администратора. 

.. fancybox:: img/number_password_store_builder.png
    :alt:  Настройка рабочего терминала в ЛК Тинькофф; информация о номере и пароле терминала.

7) Чекбокс **Использовать QR-код для оплаты** — отметьте, если хотите, чтобы при оплате заказа открывалась страница с QR-кодом.

8) Теперь идут настройки, связанные с формированием чеков. 

   Чекбокс **Отправлять чек** — отметьте, если хотите отсылать чеки в Тинькофф. Обычно касса отправляет два чека:

   * Чек на предоплату, когда списали деньги с карты.

   * Закрывающий чек, когда оказали услугу или отправили товар. 

   Чтобы передача чеков заработала, онлайн-кассу следует активировать. Для этого откройте вкладку *Онлайн-касса* в личном кабинете Тинькофф, заполните поля для её настройки — данные об онлайн-кассе появляются у владельца при получении кассы (приобретите самостоятельно или через Тинькофф).

   **Статус заказа для отправки закрывающего чека** — статус заказа после доставки товара и полного оказания услуги.

   **Тип оплаты** — выберите, как именно будут списываться средства с карты покупателя. 

   * *Оплата в два шага*

     1. Заказ создается в статусе “Открыт”.

     2. Деньги сначала резервируются (холдируются) на стороне банка, заказ остается в статусе "Открыт".

     3. На странице заказа в админке появляется кнопка для перевода средств — при нажатии деньги списываются с карты, а статус заказа меняется на “Обработан”.

     Полезно для ситуаций, связанными с возвратами. Если вдруг покупатель после оплаты отказался от товара и запросил возврат средств, то вы сможете не платить комиссию по этому платежу благодаря замораживанию средств на счёте клиента в течение семи дней после покупки (холдирование). Удобно, когда например покупатель решил вернуть одну из трёх заказанных футболок — состав заказа изменится, сумма уменьшиться, и вы заплатите комиссию только по конечной сумме.

   * При *оплате в один шаг* сразу после размещения заказа списываются деньги с карты и статус заказа становится “Обработан”.

   **Налоговая система** — выберите выгодный `налоговый режим для торговли <https://secrets.tinkoff.ru/biznes-s-nulya/nalogooblozhenie-roznica/>`_.

   **Версия ФФД** — формат фискальных документов, по которому ваша касса создает чеки.

**Сохраните** измененения в созданном способе оплаты.

Всё готово! Можно начать продавать и принимать оплату через СБП и QR-коды с помощью Тинькофф. 

.. fancybox:: img/tinkoff_payment.png
    :alt: Способ оплаты Tinkoff на странице оформления заказа.